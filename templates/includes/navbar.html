<!-- navbar.html -->
<header class="sticky top-0 z-50 bg-white shadow-sm">
    <div class="container mx-auto px-4 py-4">
        <div class="flex justify-between items-center">
            <div class="text-2xl font-bold">
                <a href="{% url 'home' %}" class="hover:text-secondary transition">TimeStamp</a>
            </div>
            
            <nav class="hidden md:flex space-x-8">
                <!-- Shop Dropdown -->
                <div class="relative group">
                    <button class="font-medium hover:text-secondary transition flex items-center">
                        Shop <i class="fas fa-chevron-down ml-1 text-xs"></i>
                    </button>

                    <div class="absolute left-0 mt-2 bg-white shadow-lg rounded-md py-4 px-6 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-300 z-50 w-56">
                        {% for main in main_categories %}
                            <div class="mb-4">
                                <a href="{% url 'user_product_list' %}?main={{ main.slug }}" class="font-semibold block hover:text-secondary">
                                    {{ main.category_name }}
                                </a>
                            </div>
                        {% endfor %}
                    </div>
                </div>

                <a href="#" class="font-medium hover:text-secondary transition">About</a>
                <a href="#" class="font-medium hover:text-secondary transition">Journal</a>
                <a href="#" class="font-medium hover:text-secondary transition">Contact Us</a>
            </nav>

            <div class="flex items-center space-x-6">
                <div class="hidden md:flex items-center space-x-4 text-sm">
                    <!-- Search Bar (Expands on hover) -->
                    <div class="group flex items-center bg-gray-100 rounded-lg px-3 py-2 transition-all duration-300 hover:bg-gray-200">
                        <form action="{% url 'user_product_list' %}" method="GET" class="flex items-center">
                            <input 
                                type="text" 
                                name="search"
                                placeholder="Search..." 
                                class="bg-transparent focus:outline-none w-20 group-hover:w-32 transition-all duration-300 text-sm"
                            >
                            <button type="submit" class="text-gray-500 hover:text-secondary ml-2">
                                <i class="fas fa-search"></i>
                            </button>
                        </form>
                    </div>
            
                    <!-- ============= CHANGE #1: UPDATED WISHLIST LINK ============= -->
                    {% if user.is_authenticated %}
                    <!-- Wishlist with Badge -->
                    <div class="relative">
                        <a href="{% url 'wishlist_view' %}" class="fas fa-heart cursor-pointer hover:text-secondary transition"></a>
                        {% if wishlist_item_count > 0 %}
                        <span class="absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full w-3 h-3 flex items-center justify-center">
                            {{ wishlist_item_count }}
                        </span>
                        {% endif %}
                    </div>
                    {% endif %}            
                    <!-- ============= CHANGE #2: UPDATED CART LINK ============= -->
                    <!-- Cart with Badge -->
                    <div class="relative">
                        {% if user.is_authenticated %}
                            <a href="{% url 'cart_view' %}" class="fas fa-shopping-bag cursor-pointer hover:text-secondary transition"></a>
                            {% if cart_item_count > 0 %}
                            <span class="absolute -top-2 -right-2 bg-blue-500 text-white text-xs rounded-full w-3 h-3 flex items-center justify-center">
                                {{ cart_item_count }}
                            </span>
                            {% endif %}
                        {% else %}
                            <a href="{% url 'login' %}?next={% url 'cart_view' %}" class="fas fa-shopping-bag cursor-pointer hover:text-secondary transition"></a>
                        {% endif %}
                    </div>
                    <!-- ============= END CHANGE #2 ============= -->
            
                    <!-- User Profile or Login -->
                    {% if user.is_authenticated %}
                        <!-- Logged In User Dropdown -->
                        <div class="relative group">
                            <button class="flex items-center space-x-2 hover:text-secondary transition">
                                <i class="fas fa-user-circle text-xl"></i>
                                <span class="font-medium">{{ user.first_name }}</span>
                                <i class="fas fa-chevron-down text-xs"></i>
                            </button>

                            <!-- ============= CHANGE #3: UPDATED DROPDOWN MENU ============= -->
                            <!-- Dropdown Menu -->
                            <div class="absolute right-0 mt-2 w-48 bg-white shadow-lg rounded-md py-2 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-300 z-50">
                                <a href="{% url 'profile' %}" class="block px-4 py-2 hover:bg-gray-100 transition">
                                    <i class="fas fa-user mr-2"></i>My Profile
                                </a>
                                {% if user.is_authenticated %}
                                <a href="{% url 'user_orders_list' %}" class="block px-4 py-2 hover:bg-gray-100 transition">
                                    <i class="fas fa-box mr-2"></i>My Orders
                                </a>
                                {% endif %}
                                <a href="{% url 'wishlist_view' %}" class="block px-4 py-2 hover:bg-gray-100 transition">
                                    <i class="fas fa-heart mr-2"></i>Wishlist
                                    {% if wishlist_item_count > 0 %}
                                    <span class="ml-1 bg-red-500 text-white text-xs px-2 py-0.5 rounded-full">
                                        {{ wishlist_item_count }}
                                    </span>
                                    {% endif %}
                                </a>
                                <a href="{% url 'cart_view' %}" class="block px-4 py-2 hover:bg-gray-100 transition">
                                    <i class="fas fa-shopping-cart mr-2"></i>Cart
                                    {% if cart_item_count > 0 %}
                                    <span class="ml-1 bg-blue-500 text-white text-xs px-2 py-0.5 rounded-full">
                                        {{ cart_item_count }}
                                    </span>
                                    {% endif %}
                                </a>

                                <a href="{% url 'wallet_dashboard' %}" 
                                class="block px-4 py-2 hover:bg-gray-100 transition">
                                 <i class="fas fa-wallet"></i> Wallet
                             </a>
                             

                                <a href="#" class="block px-4 py-2 hover:bg-gray-100 transition">
                                    <i class="fas fa-cog mr-2"></i>Settings
                                </a>
                                <hr class="my-2">
                                <form action="{% url 'logout' %}" method="post">
                                    {% csrf_token %}
                
                                    <button type="submit" class="flex items-center px-3 py-2 mt-2 text-red-600 hover:bg-red-50 rounded-lg">
                                    <i class="fas fa-sign-out-alt mr-3"></i>
                                    Logout
                                    </button>
                            </div>
                            <!-- ============= END CHANGE #3 ============= -->
                        </div>
                    {% else %}
                        <!-- Not Logged In - Show Login/Signup -->
                        <div class="flex items-center space-x-3">
                            <a href="{% url 'login' %}" class="font-medium hover:text-secondary transition">
                                Login
                            </a>
                            <span class="text-gray-300">|</span>
                            <a href="{% url 'register' %}" class="px-4 py-2 bg-secondary text-white rounded-lg hover:bg-opacity-90 transition font-medium">
                                Sign Up
                            </a>
                        </div>
                    {% endif %}
                </div>
                
                <!-- Mobile Menu Button -->
                <button class="md:hidden" onclick="toggleMobileMenu()">
                    <i class="fas fa-bars text-xl"></i>
                </button>
            </div>
        </div>

        <!-- ============= CHANGE #4: UPDATED MOBILE MENU ============= -->
        <!-- Mobile Menu -->
        <div id="mobileMenu" class="hidden md:hidden mt-4 pb-4 border-t pt-4">
            <div class="flex flex-col space-y-4">
                <!-- Search -->
                <form action="{% url 'user_product_list' %}" method="GET" class="flex items-center bg-gray-100 rounded-lg px-3 py-2">
                    <input 
                        type="text" 
                        name="search"
                        placeholder="Search..." 
                        class="bg-transparent focus:outline-none w-full text-sm"
                    >
                    <button type="submit" class="text-gray-500 hover:text-secondary ml-2">
                        <i class="fas fa-search"></i>
                    </button>
                </form>

                <!-- Navigation Links -->
                <a href="{% url 'user_product_list' %}" class="font-medium hover:text-secondary transition">Shop</a>
                <a href="#" class="font-medium hover:text-secondary transition">About</a>
                <a href="#" class="font-medium hover:text-secondary transition">Journal</a>
                <a href="#" class="font-medium hover:text-secondary transition">Contact Us</a>
                
                <!-- Wishlist & Cart for Mobile -->
                {% if user.is_authenticated %}
                    <!-- Wishlist -->
                    <a href="{% url 'wishlist_view' %}" class="flex items-center justify-between font-medium hover:text-secondary transition">
                        <span><i class="fas fa-heart mr-2"></i> Wishlist</span>
                        {% if wishlist_item_count > 0 %}
                        <span class="bg-red-500 text-white text-xs px-2 py-1 rounded-full">
                            {{ wishlist_item_count }}
                        </span>
                        {% endif %}
                    </a>

                    <!-- Cart -->
                    <a href="{% url 'cart_view' %}" class="flex items-center justify-between font-medium hover:text-secondary transition">
                        <span><i class="fas fa-shopping-bag mr-2"></i> Cart</span>
                        {% if cart_item_count > 0 %}
                        <span class="bg-blue-500 text-white text-xs px-2 py-1 rounded-full">
                            {{ cart_item_count }}
                        </span>
                        {% endif %}
                    </a>
                {% else %}
                    <!-- Cart for non-authenticated users -->
                    <a href="{% url 'login' %}?next={% url 'cart_view' %}" class="flex items-center font-medium hover:text-secondary transition">
                        <i class="fas fa-shopping-bag mr-2"></i> Cart
                    </a>
                {% endif %}

                {% if user.is_authenticated %}
                    <!-- User Menu Mobile -->
                    <div class="border-t pt-4 mt-4">
                        <div class="flex items-center space-x-3 mb-4">
                            <div class="w-10 h-10 rounded-full bg-secondary text-white flex items-center justify-center">
                                <i class="fas fa-user text-lg"></i>
                            </div>
                            <div>
                                <p class="font-semibold">{{ user.first_name }} {{ user.last_name }}</p>
                                <p class="text-xs text-gray-500">{{ user.email }}</p>
                            </div>
                        </div>
                        <a href="{% url 'profile' %}" class="block py-2 hover:text-secondary transition">
                            <i class="fas fa-user mr-2"></i>My Profile
                        </a>
                        <a href="#" class="block py-2 hover:text-secondary transition">
                            <i class="fas fa-box mr-2"></i>My Orders
                        </a>
                        <a href="{% url 'wishlist_view' %}" class="flex items-center justify-between py-2 hover:text-secondary transition">
                            <span><i class="fas fa-heart mr-2"></i>Wishlist</span>
                            {% if wishlist_item_count > 0 %}
                            <span class="bg-red-500 text-white text-xs px-2 py-0.5 rounded-full">
                                {{ wishlist_item_count }}
                            </span>
                            {% endif %}
                        </a>
                        <a href="{% url 'cart_view' %}" class="flex items-center justify-between py-2 hover:text-secondary transition">
                            <span><i class="fas fa-shopping-cart mr-2"></i>Cart</span>
                            {% if cart_item_count > 0 %}
                            <span class="bg-blue-500 text-white text-xs px-2 py-0.5 rounded-full">
                                {{ cart_item_count }}
                            </span>
                            {% endif %}
                        </a>

                        <a href="{% url 'wallet_dashboard' %}" 
                        class="block px-4 py-2 hover:bg-gray-100 transition">
                         <i class="fas fa-wallet"></i> Wallet
                     </a>

                        <a href="#" class="block py-2 hover:text-secondary transition">
                            <i class="fas fa-cog mr-2"></i>Settings
                        </a>

                        <!-- Fixed Logout Form -->
                        <form action="{% url 'logout' %}" method="post" class="mt-2">
                            {% csrf_token %}
                            <button type="submit" class="w-full text-left py-2 text-red-600 hover:text-red-700 transition">
                                <i class="fas fa-sign-out-alt mr-2"></i>Logout
                            </button>
                        </form>
                    </div>
                {% else %}
                    <!-- Login/Signup Mobile -->
                    <div class="border-t pt-4 mt-4 space-y-3">
                        <a href="{% url 'login' %}" class="block w-full py-2 px-4 border border-secondary text-secondary rounded-lg hover:bg-secondary hover:text-white transition text-center font-medium">
                            Login
                        </a>
                        <a href="{% url 'register' %}" class="block w-full py-2 px-4 bg-secondary text-white rounded-lg hover:bg-opacity-90 transition text-center font-medium">
                            Sign Up
                        </a>
                    </div>
                {% endif %}
            </div>
        </div>
        <!-- ============= END CHANGE #4 ============= -->
    </div>
</header>

<script>
function toggleMobileMenu() {
    const menu = document.getElementById('mobileMenu');
    menu.classList.toggle('hidden');
}
</script>